<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Danny</title>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css"> -->
    <link rel="stylesheet" type="text/css" href="./css/bulma.min.css">
    <link rel="stylesheet" type="text/css" href="./css/calendar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      $(document).ready(function() {
        $(".navbar-burger").click(function() {
            $(".navbar-burger").toggleClass("is-active");
            $(".navbar-menu").toggleClass("is-active");
        });
      });
    </script>
    <!-- <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script> -->
    <!-- <script async defer src="https://apis.google.com/js/api.js"></script> -->
    <!-- <script src="https://accounts.google.com/gsi/client" defer></script> -->
    <script src="https://accounts.google.com/gsi/client" onload="initClient()" async defer></script>
    <script>
      var client;
      var access_token;

      var EventType = {
        0:"nothing",
        1:"work",
        2:"programming",
        3:"holiday",
        4:"other"
      }

      var eventPool = new Object();

      function initClient(){
        client = google.accounts.oauth2.initTokenClient({
          client_id: '616265016561-of2t07oji032h5al2nuu1ehu4ms8ic8m.apps.googleusercontent.com',
          scope: 'https://www.googleapis.com/auth/calendar.events.readonly',
          callback: (tokenResponse)=>{
            access_token = tokenResponse.access_token;
          }
        })
      }

      function getToken(){
        client.requestAccessToken();
      }

      function revokeToken(){
        google.accounts.oauth2.revoke(access_token, ()=>{console.log('access token revoked')});
      }

      function utc(datetime){
        return Date.UTC(datetime.getFullYear(), datetime.getMonth(), datetime.getDate());
      }

      function loadCalendar() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'https://www.googleapis.com/calendar/v3/calendars/primary/events')
        xhr.setRequestHeader('Authorization', 'Bearer ' + access_token);
        xhr.send();

        // check start, end , summary

        function gatherEvents(xmlObject){
          console.log("gathering...");
          // console.log("gathering: " + xmlObject.items.toString());
          // for(let i =0;i<xmlObject.items;i++){
          for(const [i, event] of Object.entries(xmlObject.items)){
            if(event.end === undefined){
              console.log(i + " skipped");
              console.log(event);
              continue;
            } 
            // event = xmlObject.items[i];

            // check if event is in the past
            console.log("event: " + event.end);

            let current_time = new Date();
            let timestamp_end = utc(new Date(event.end.dateTime));

            if(isNaN(timestamp_end)){
              console.log(i + " skipped");
              console.log(event);
              console.log(event.end);
              console.log(event.end.dateTime);
              continue;
            }
            
            if(timestamp_end < utc(current_time)) continue;

            // console.log("ts end: " + timestamp_end);

            let timestamp_start = utc(new Date(event.start.dateTime));
            // check if event summary contains word "work" or "vakantie"
            
            let event_summary = event.summary.toLowerCase();
            let category = EventType[4];
            if(event_summary.includes("vakantie")) category = EventType[3];
            if(event_summary.includes("werk")) category = EventType[1];

            console.log("event type: " + category + ". found: " + event_summary);

            let event_dt = new Date(timestamp_start);
            let str = event_dt.getDate() + "-" + (event_dt.getMonth()+1) + "-" + event_dt.getFullYear();
            // console.log("datestring: " + str);
            eventPool[str] = category;

            // add an event for every day of multi day events.
            // for(let d = timestamp_start; d < timestamp_end; d += 1000*60*60*24*1){
            //   eventPool[new Date(d)] = category;
            // }

          }
          

        }

        xhr.onload = function() {
          // console.log(`Loaded: ${xhr.status} ${xhr.response}`);
          let returnedEvents = JSON.parse(xhr.response);
          gatherEvents(returnedEvents);
          drawCalendar();
        };
      }

      // req.addEventListener("error", transferFailed);
      
    </script>
    
    <!-- <script>
      window.onload = function () {
        google.accounts.id.initialize({
          client_id: '616265016561-of2t07oji032h5al2nuu1ehu4ms8ic8m.apps.googleusercontent.com',
          callback: handleCredentialResponse
        });
        google.accounts.id.prompt();
      };
    </script> -->
    
  </head>
  <body>
    <nav class="navbar is-black" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <div role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="yourstandardnavbar">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </div>
      </div>

      <div id="yourstandardnavbar" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item">
            <span>About</span>
          </a>

          <a class="navbar-item" href="./resume.pdf">
            Resume
          </a>

          <a class="navbar-item" href="https://github.com/drogaar">
            <span class="icon">
                <i class="fab fa-github"></i>
            </span>
            <span>Github</span>
          </a>

          <a class="navbar-item">
            <span>Planning</span>
          </a>
        </div>

        <div class="navbar-end">
          <!-- <div class="buttons"> -->
            <!-- <button class="button is-dark" onclick="getToken()"> Get access token</button> -->
            <a class="navbar-item" onclick="getToken()">
              <span>Authorise your google</span>
            </a>
            <a class="navbar-item" onclick="loadCalendar()">
              <span>Load calendar</span>
            </a>
            <a class="navbar-item" onclick="revokeToken()">
              <span>Revoke google</span>
            </a>
            <!-- <button class="button is-dark is-inverted" onclick="revokeToken()"> Revoke token</button> -->
          <!-- </div> -->
        </div>
      </div>
    </nav>

    <!-- Header -->
    <section class="hero is-black is-medium">
      <div class="hero-body">
        <div class="container">
          <h1 class="title is-1">
            Danny Rogaar
          </h1>
        </div>
      </div>
    </section>

    <!-- About -->
    <section class="section" id="about">
      <div class="section-heading">
        <div class="container">
          <h3 class="title is-2">About</h3>
          <p>
            I am a master student <strong>AI</strong> currently looking for work and a place to improve. I have experience with neural networks, machine learning and have personally enjoyed scientific visualisations. Amongst other skills and languages, I have become good at python while working on these topics. <br>For more info, feel free to checkout my <a href="./resume.pdf">resume</a>!
          </p>
        </div>
      </div>
    </section>

    <!-- Planning-->
    <!-- <section class="section" id="planning">
      <div class="section-heading">
        <div class="container">
          <h3 class="title is-2">Planning</h3>
          <p> -->
            <!--most basic google calendar embed here: -->
            <!-- <iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=1&bgcolor=%23ffffff&ctz=Europe%2FAmsterdam&src=ZGFubnlyb2dhYXJAZ21haWwuY29t&src=YWRkcmVzc2Jvb2sjY29udGFjdHNAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t&src=bmwuZHV0Y2gjaG9saWRheUBncm91cC52LmNhbGVuZGFyLmdvb2dsZS5jb20&src=ZW4uZHV0Y2gjaG9saWRheUBncm91cC52LmNhbGVuZGFyLmdvb2dsZS5jb20&src=c3JhZWdsY2xhbjhxNm01NTFqYzFnbjZubHQ2MWZrM2FAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&color=%237986CB&color=%2333B679&color=%230B8043&color=%230B8043&color=%23EF6C00" style="border:solid 1px #777" width="800" height="600" frameborder="0" scrolling="no"></iframe> -->
            <!-- step 1: setup oauth so that user will afterwards be able to see their own events-->

            <!-- step 2: make a google calendar api call to get the events of the user -->
            <!-- step 3: parse the events to a json format -->
            <!-- step 4: display the events in the website -->

            
            
          <!-- </p>
          </div>  
        </div>
    </section> -->

    <!-- <section class="section" id="Planning">
      <div class="calendar">
        <div class="week">
            <div class="day">1</div>
            <div class="day">2</div>
            <div class="day">3</div>
            <div class="day">4</div>
            <div class="day">5</div>
            <div class="day">6</div>
            <div class="day">7</div>
        </div>
        <div class="week">
          <div class="day">1</div>
          <div class="day">2</div>
          <div class="day">3</div>
          <div class="day">4</div>
          <div class="day">5</div>
          <div class="day">6</div>
          <div class="day">7</div>
      </div>
    </div>
    </section> -->

    <section class="section">
      <div class="calendar"  id="planning_auto">
        <script>
          function drawCalendar(){



            // get current date
            let current_date = new Date();
            console.log("current_date" + current_date.toString());
            console.log("current_date+3" + (current_date + 3).toString());
            let startDate = new Date(current_date.getFullYear(), 0, 1);
            let days = Math.floor((current_date - startDate) / (24*60*60*1000));
            let current_week = Math.ceil(days / 7);

            const Weekdays = {
              0:"Mo",
              1:"Tu",
              2:"We",
              3:"Th",
              4:"Fr",
              5:"Sa",
              6:"Su",
            }

            function addWeek(weekNumber){
              let week = document.createElement("div");
              week.className = "week";
              // div.innerHTML="";
              week.id="w" + weekNumber;
              document.getElementById("planning_auto").appendChild(week);
              // console.log("created: " + weekNumber);
            }

            function addDay(weekNumber, dayNumber, text, classname="day", category=0){
              console.log("event type T2: " + category);

              let day = document.createElement("div");
              day.className = classname;
              day.innerHTML=text;
              day.id="w" + weekNumber + "d" + dayNumber;
              // let txt = "empty";
              // if(category!=0) day.innerHTML = day.innerHTML + "+++"
              const colors = ["#0099cc","#c0c0c0","#587b2e","#990000","#000000","#1C8200","#987baa","#981890","#AA8971","#1987FC","#99081E"];
              if(category==EventType[1]) day.style.backgroundColor = colors[1];//rgb(0, 0, 255);
              if(category==EventType[2]) day.style.backgroundColor = colors[2];//rgb(255, 0, 0);
              if(category==EventType[3]) day.style.backgroundColor = colors[3];//rgb(0, 255, 0);
              if(category==EventType[4]) day.style.backgroundColor = colors[3];//rgb(255, 255, 0);

              // if(category==1) day.innerHTML="WORK";
              // if(category==3) day.innerHTML="HOLIDAY";
              // if(category==4) day.innerHTML="OTHER";

              // if(category===EventType[1]){txt="WORK";} else
              // if(category===EventType[3]){txt="HOLIDAY";} else 
              // if(category===EventType[4]){txt="OTHER";} else 
              // {txt = text};

              // day.innerHTML=txt;

              // console.log("finding: " + "w" + weekNumber);
              document.getElementById("w" + weekNumber).appendChild(day);
            }

            function checkForEvent(datetime){
              // returns a event Enum representing the given date.
              // const EventType = {
              //   0:"nothing",
              //   1:"work",
              //   2:"programming",
              //   3:"holiday"
              //   4:"other"
              // }

              function within(date, start, end){
                return utc(start) < utc(date) && utc(date) < utc(end);
              }

              holiday1_start = new Date(2023, 11, 24);//+1 on day and month
              holiday1_end = new Date(2024, 0, 4);
              holiday2_start = new Date(2024, 6, 14);
              holiday2_end = new Date(2024, 7, 29);

              if(within(datetime, holiday1_start, holiday1_end)){
                console.log("h1");
                return EventType[3];
              }
              if(within(datetime, holiday2_start, holiday2_end)){
                console.log("h2");
                return EventType[3];
              }
              if(datetime.getDay()===0){
                return EventType[0];
              }// no work on sundays
              let datestr = datetime.getDate() + "-" + (datetime.getMonth()+1) + "-" + datetime.getFullYear();
              if(datestr in eventPool){
                console.log("found event: " + eventPool[datestr]);
                return eventPool[datestr];
              }// SNS
              
              return EventType[2]; //weekday, lets finish the project
            }

            // Calendar Header
            addWeek(-2);
            addDay(-2, -2, "week No");
            addDay(-2, -1, "", classname="day_hspace");
            for(let i=0;i<7;i++) addDay(-2, i, Weekdays[i]);
            addWeek(-1);

            console.log("eventPool: " + eventPool.toString());

            for(let w=0; w<52; w++){
              let w_ = (w + current_week) % 52;

              addWeek(w);
              addDay(w, -2, w_);
              addDay(w, -1, "", classname="day_hspace");

              starting_weekday = (current_date.getDay() - 1) % 7;
              for(let d=0; d<7; d++){
                if(w===0 && d < starting_weekday){
                  addDay(w, d, "", classname="day_hspace");
                  continue;
                }

                // let future_date = new Date(current_date.getUTCMilliseconds() + 1000*60*60*24*(d + w*7));
                // let future_date = new Date(current_date.getUTCMilliseconds());
                let future_date = new Date(utc(current_date) + 1000*60*60*24*(w*7 + d - starting_weekday));
                // future_date.setDate(current_date.getDate() + (d + w*7));
                // console.log(future_date.toString());
                let cat = checkForEvent(future_date);


                // console.log("event type: " + cat);
                addDay(w, d, future_date.getDate() + "-" + (future_date.getMonth()+1), classname="day", category=cat);
                // addDay(w, d, future_date.getDate() + "-" + (future_date.getMonth()+1));
              }
            }
          }

          drawCalendar();
        </script>
      </div>
    </section>

  </body>
</html>
